<!DOCTYPE html>
<html lang="en">

	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>D3 Assignment 3</title>

	    <!-- Libraries -->
	    <!-- jQuery -->
	    <script src="https://code.jquery.com/jquery.min.js"></script>
	    <!-- D3 -->
	    <script src="https://d3js.org/d3.v4.js"></script>

	    <!-- Bootstrap, ignore for the tutorial -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	        crossorigin="anonymous">

	    <!-- Our files -->
	    <!-- main.css -->
	    <link rel="stylesheet" href="css/main.css" />

	    <!-- main js file :) -->
		<script src="js/index.js"></script>
		<script src="https://d3js.org/d3.v4.js"></script>
		<!-- Boundaries taken from https://github.com/seattleio/seattle-boundaries-data-->
    	<script src = "data/neighborhoods.geojson"></script>
	</head>

	<body>
		<div class="container">
			<section id="title">
					<h1>Assignment 3 Interactive Visualization</h1>
			</section>

			<div id="info">
				<p>Mouse over a point for more information</p>
			</div>
			<div id ="visualization">
				<div id="svg"></div>
			</div>

		<div id="controls">
				<div id="sliderContainer">
					<label for="month">Month:</label>
					<input id="timeslide" type="range" min="0" max="11" value = "0" step ="1"/><br>
					<span id ="range">January</span>
				</div>

				<!--put all interactions in here?? -->
				<div id="dropDownContainer">
					<label for="crimeSector">Crime Location:</label>
					<div id="crimeSector">
						<select id="form-select">
							<option value="b">Sector B</option>
							<option value="c">Sector C</option>
							<option value="d">Sector D</option>
							<option value="e">Sector E</option>
							<option value="f">Sector F</option>
							<option value="g">Sector G</option>
							<option value="j">Sector J</option>
							<option value="k">Sector K</option>
							<option value="l">Sector L</option>
							<option value="m">Sector M</option>
							<option value="n">Sector N</option>
							<option value="o">Sector O</option>
							<option value="q">Sector Q</option>
							<option value="r">Sector R</option>
							<option value="s">Sector S</option>
							<option value="u">Sector U</option>
							<option value="w">Sector W</option>
						</select>
					</div>
				</div>
			</div>
		</div>


		<script>
				var width = 700,
				height = 580;
				var dataset;

				var inputValue = null;
				var month = ["January","February","March","April","May","June","July","August","September","October","November","December"];

				var svg = d3.select('#svg')
				.append('svg')
				.attr('width', width)
				.attr('height', height)

				var g = svg.append('g');

				//set projection
				var projection = d3.geoAlbers()
				.scale(110000)
				.rotate([122.33, 0])
				.center([0, 47.6062])
				.translate([width/2, height/2]);

				var geoPath = d3.geoPath()
				.projection(projection);

				//set path
				g.selectAll("path")
				.data(neighborhoods_json.features)
				.enter()
				.append("path")
				.attr('fill', 'none')
				.attr("stroke", "#696969")
				.attr('d', geoPath);

			//add data points
			d3.csv("data/clean-data.csv", function (error, data) {
				// change into number format

				data.forEach(function (d) {
					d.Latitude= +d.Latitude;
					d.Longitude = +d.Longitude;
				});
				dataset = data
				drawViz(dataset);
			});

			function drawViz(data){
				var incidents = svg.append("g");

				incidents.selectAll("path")
				.data(data)
				.enter()
				.append("circle")
				.attr("fill", initialDate)
				.attr("stroke", initialDate2)
				.attr("r", 3)
				.attr("cx", function(d){
					var coords = projection([d.Longitude, d.Latitude])
					return coords[0];
				})
				.attr("cy", function(d){
					var coords = projection([d.Longitude, d.Latitude])
					return coords[1];
				})
				.attr("d", geoPath)

				// add mouse over event
				.on("mouseover", function(d){

					d3.select("p").html("<b>Block Location: </b>" + d["Hundred.Block.Location"] + "\n"
						+ "<b>Zone/Beat: </b>" + d["Zone.Beat"] + "\n"
					 	+ "<b>Group Description: </b>" + d["Event.Clearance.Description"] + "\n"
						+ "<b>At Scene Date: </b>" + d["Date"] + "\n"
						+ "<b>At Scene Time: </b>" + d["Time"]);
					d3.select(this).attr("class","incident hover");
				})
				.on("mouseout", function(d){
					d3.select("h2").html("");
					d3.select(this).attr("class","incident");
				})
				.attr("d", geoPath)
				.attr("class", "incident");
			}

			//create slider
			d3.select("#timeslide").on("input", function() {
				update(+this.value);
			});

			// update the fill of each SVG of class "incident" with value
			function update(value) {
				document.getElementById("range").innerHTML=month[value];
				inputValue = month[value];
				d3.selectAll(".incident")
				.attr("fill", dateMatch)
				.attr("stroke", dateMatch2);
			}

			//match the year with the slider input
			function dateMatch(data, value) {
				var date = new Date(data.Date);
				var m = month[date.getMonth()];

				if (inputValue == m) {
					this.parentElement.appendChild(this);
					return "#5e81fd";
				} else {
					return "none";
				};
			}

			//remove other data points
			function dateMatch2(data, value) {
				var date = new Date(data.Date);
				var m = month[date.getMonth()];

				if (inputValue == m) {
					this.parentElement.appendChild(this);
					return "#3c3c3c";
				} else {
					return "none";
				};
			}

			//initial viZ
			function initialDate(d,i){
				var date = new Date(d.Date);
				var m = month[date.getMonth()];

				if (m == "January") {
					this.parentElement.appendChild(this);
					return "#5e81fd";
				} else {
					return "none";
				};
			}
			function initialDate2(d,i){
				var date = new Date(d.Date);
				var m = month[date.getMonth()];

				if (m == "January") {
					this.parentElement.appendChild(this);
					return "#3c3c3c";
				} else {
					return "none";
				};
			}
			</script>



	</body>

</html>
