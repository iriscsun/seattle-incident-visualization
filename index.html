<!DOCTYPE html>
<html lang="en">

	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>D3 Assignment 3</title>

	    <!-- Libraries -->
	    <!-- jQuery -->
	    <script src="https://code.jquery.com/jquery.min.js"></script>
	    <!-- D3 -->
	    <script src="https://d3js.org/d3.v4.js"></script>

	    <!-- Bootstrap, ignore for the tutorial -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	        crossorigin="anonymous">

	    <!-- Our files -->
	    <!-- main.css -->
	    <link rel="stylesheet" href="css/main.css" />

	    <!-- main js file :) -->
		<script src="js/index.js"></script>
		<script src="https://d3js.org/d3.v4.js"></script>
		<!-- Boundaries taken from https://github.com/seattleio/seattle-boundaries-data-->
    	<script src = "data/neighborhoods.geojson"></script>
	</head>

	<body>
		<div class="container">
	    <section id="title">
	            <h1>Assignment 3 Interactive Visualization</h1>
	    </section>
			<div id="info">
							<p>Mouse over a point for more information</p>
			</div>
			<div id="svg">
			</div>
		</div>

		<script>
				var width = 700,
				height = 580;

				var svg = d3.select('#svg') //changed this to attach on new svg div
				.append('svg')
				.attr('width', width)
				.attr('height', height)

				var g = svg.append('g');

				var projection = d3.geoAlbers()
				.scale(120000)
				.rotate([122.33, 0])
				.center([0, 47.6062])
				.translate([width/5, height/3]);

				var geoPath = d3.geoPath()
				.projection(projection);

				g.selectAll("path")
				.data(neighborhoods_json.features)
				.enter()
				.append("path")
				.attr('fill', 'none')
				.attr("stroke", "#696969")
				.attr('d', geoPath);



			d3.csv("data/clean-data.csv", function (error, data) {
				// change string (from CSV) into number format
				console.log(data[1]);
				data.forEach(function (d) {
					d.Latitude= +d.Latitude;
					d.Longitude = +d.Longitude;
					//console.log(d.Latitude, d.Longitude)
				});

				var incidents = svg.append("g");

				incidents.selectAll("path")
				.data(data)
				.enter()
				.append("circle")
				.attr("r", 3)
				//.attr("transform", function(d) { return "translate(" + projection([d.Longitude, d.Latitude]) + ")"})
				.attr("cx", function(d){
					var coords = projection([d.Longitude, d.Latitude])
					//return coords[0];
					//console.log(coords)
					return coords[0];
				})
				.attr("cy", function(d){
					var coords = projection([d.Longitude, d.Latitude])
					return coords[1];
				})
				.attr("fill", "#900")
				.attr("stroke" , "#999")
				.attr("d", geoPath)

				// add mouse over event
				.on("mouseover", function(d){

					d3.select("p").text("Block Location: " + d["Hundred.Block.Location"] + "\n"
						+ "Zone/Beat: " + d["Zone.Beat"] + "\n"
					 	+ "Group Description: " + d["Event.Clearance.Description"] + "\n"
						+ "At Scene Date: " + d["Date"] + "\n"
						+ "At Scene Time: " + d["Time"]);
					d3.select(this).attr("class","incident hover");
				})
				.on("mouseout", function(d){
					d3.select("h2").text("");
					d3.select(this).attr("class","incident");
				})
			});



			</script>
	</body>

</html>
