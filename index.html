<!DOCTYPE html>
<html lang="en">

	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>D3 Assignment 3</title>

	    <!-- Libraries -->
	    <!-- jQuery -->
	    <script src="https://code.jquery.com/jquery.min.js"></script>
	    <!-- D3 -->
	    <script src="https://d3js.org/d3.v4.js"></script>

	    <!-- Bootstrap, ignore for the tutorial -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	        crossorigin="anonymous">

	    <!-- Our files -->
	    <!-- main.css -->
	    <link rel="stylesheet" href="css/main.css" />

	    <!-- main js file :) -->
		<script src="js/index.js"></script>
		<script src="https://d3js.org/d3.v4.js"></script>
		<!-- Boundaries taken from https://github.com/seattleio/seattle-boundaries-data-->
    	<script src = "data/neighborhoods.geojson"></script>
	</head>

	<body>
		<div class="container">
	    <section id="svg">
	            <h1>Assignment 3 Interactive Visualization</h1>

	    </section>
		</div>
		<div id="sliderContainer">
				<input id="timeslide" type="range" min="0" max="3" value = "0" step ="1"/><br>
				<span id ="range">2015</span>
			</div>
		
		<script>
				var width = 700,
				height = 580;
				
				var inputValue = null;
				var year = ["2015", "2016", "2017", "2018"];
				
				var svg = d3.select('body')
				.append('svg')
				.attr('width', width)
				.attr('height', height)
		
				var g = svg.append('g');
		
				//set projection
				var projection = d3.geoAlbers()
				.scale(110000)
				.rotate([122.33, 0])
				.center([0, 47.6062])
				.translate([width/2, height/2]);
		
				var geoPath = d3.geoPath()
				.projection(projection);
		
				//set path
				g.selectAll("path")
				.data(neighborhoods_json.features)
				.enter()
				.append("path")
				.attr('fill', 'none')
				.attr("stroke", "#696969")
				.attr('d', geoPath);
			
				
			//add data points
			d3.csv("data/clean-data.csv", function (error, data) {
				// change into number format
				data.forEach(function (d) {
					d.Latitude= +d.Latitude;
					d.Longitude = +d.Longitude;
				});
				
				var incidents = svg.append("g");
				
				incidents.selectAll("path")
				.data(data)
				.enter()
				.append("circle")
				.attr("fill", initialDate)
				.attr("r", 3)
				.attr("cx", function(d){ 
					var coords = projection([d.Longitude, d.Latitude])
					return coords[0];
				})
				.attr("cy", function(d){ 
					var coords = projection([d.Longitude, d.Latitude])
					return coords[1];
				})
				//.attr("fill", "#5e81fd")
				.attr("stroke" , "#3c3c3c")
				.attr("d", geoPath)
				.attr("class", "incident")
				.on("mouseover", function(d){
					d3.select(this).attr("class","incident hover");
				})
				.on("mouseout", function(d){
					d3.select("h2").text("");
					d3.select(this).attr("class","incident");
				});
			});

			//create slider 
			d3.select("#timeslide").on("input", function() {
				update(+this.value);
			});

			// update the fill of each SVG of class "incident" with value
			function update(value) {
				document.getElementById("range").innerHTML=year[value];
				inputValue = year[value];
				d3.selectAll(".incident")
				.attr("fill", dateMatch)
				.attr("stroke", dateMatch2);
			}
			
			//match the year with the slider input
			function dateMatch(data, value) {
				var date = new Date(data.Date);
				var Year = date.getFullYear();

				if (inputValue == Year) {
					this.parentElement.appendChild(this);
					return "red";
				} else {
					return "none";
				};
			}

			//remove other data points
			function dateMatch2(data, value) {
				var date = new Date(data.Date);
				var Year = date.getFullYear();

				if (inputValue == Year) {
					this.parentElement.appendChild(this);
					return "#3c3c3c";
				} else {
					return "none";
				};
			}

			//initial viZ
			function initialDate(d,i){
				var date = new Date(d.Date);
				var Year = date.getFullYear();

				if (Year == "2015") {
					this.parentElement.appendChild(this);
					return "red";
				} else {
					return "#999";
				};
			}
			</script>
			
			

	</body>

</html>
